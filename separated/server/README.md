# üéÆ –ë—É–Ω–∫–µ—Ä - –°–µ—Ä–≤–µ—Ä–Ω–∞—è —á–∞—Å—Ç—å

Backend –¥–ª—è –∏–≥—Ä—ã "–ë—É–Ω–∫–µ—Ä" –Ω–∞ Node.js —Å Socket.IO.

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –õ–æ–∫–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
npm install

# –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞
npm start

# –ò–ª–∏ –≤ —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ (—Å –∞–≤—Ç–æ–ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–æ–π)
npm run dev
```

–°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è –Ω–∞ http://localhost:3000

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env`:

```env
PORT=3000
NODE_ENV=production
```

### –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø–æ—Ä—Ç–∞

–í `server.js`:
```javascript
const PORT = process.env.PORT || 3000;
```

–ò–ª–∏ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ:
```bash
PORT=8080 npm start
```

## üåê –î–µ–ø–ª–æ–π

### –î–µ–ø–ª–æ–π –Ω–∞ Railway.app

1. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –Ω–∞ https://railway.app
2. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç
3. –ü–æ–¥–∫–ª—é—á–∏—Ç–µ GitHub —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –∏–ª–∏ –∑–∞–≥—Ä—É–∑–∏—Ç–µ –ø–∞–ø–∫—É
4. Railway –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç Node.js –ø—Ä–æ–µ–∫—Ç
5. –ü–æ–ª—É—á–∏—Ç–µ –ø—É–±–ª–∏—á–Ω—ã–π URL

### –î–µ–ø–ª–æ–π –Ω–∞ Render.com

1. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –Ω–∞ https://render.com
2. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π Web Service
3. –ü–æ–¥–∫–ª—é—á–∏—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
4. Build Command: `npm install`
5. Start Command: `npm start`

### –î–µ–ø–ª–æ–π –Ω–∞ Heroku

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Heroku CLI
# –í–æ–π–¥–∏—Ç–µ –≤ –∞–∫–∫–∞—É–Ω—Ç
heroku login

# –°–æ–∑–¥–∞–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
heroku create bunker-server

# –î–µ–ø–ª–æ–π
git push heroku main
```

### –î–µ–ø–ª–æ–π –Ω–∞ VPS (Ubuntu)

```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ
sudo apt update
sudo apt install nodejs npm

# –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
git clone <repo>
cd server

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
npm install

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ PM2 –¥–ª—è –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫–∞
npm install -g pm2

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä
pm2 start server.js --name bunker-server

# –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ
pm2 startup
pm2 save
```

## üîß API

### Socket.IO —Å–æ–±—ã—Ç–∏—è

**–û—Ç –∫–ª–∏–µ–Ω—Ç–∞ –∫ —Å–µ—Ä–≤–µ—Ä—É:**

- `createRoom` - —Å–æ–∑–¥–∞—Ç—å –∫–æ–º–Ω–∞—Ç—É
- `joinRoom` - –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è –∫ –∫–æ–º–Ω–∞—Ç–µ
- `startGame` - –Ω–∞—á–∞—Ç—å –∏–≥—Ä—É (—Ç–æ–ª—å–∫–æ —Ö–æ—Å—Ç)
- `toDiscussion` - –ø–µ—Ä–µ–π—Ç–∏ –∫ –æ–±—Å—É–∂–¥–µ–Ω–∏—é
- `toVoting` - –ø–µ—Ä–µ–π—Ç–∏ –∫ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—é
- `vote` - –ø—Ä–æ–≥–æ–ª–æ—Å–æ–≤–∞—Ç—å
- `endVoting` - –∑–∞–≤–µ—Ä—à–∏—Ç—å –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ
- `continueGame` - –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å –∏–≥—Ä—É
- `sendMessage` - –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —á–∞—Ç

**–û—Ç —Å–µ—Ä–≤–µ—Ä–∞ –∫ –∫–ª–∏–µ–Ω—Ç—É:**

- `roomJoined` - –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –≤—Ö–æ–¥–∞ –≤ –∫–æ–º–Ω–∞—Ç—É
- `roomUpdate` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∫–æ–º–Ω–∞—Ç—ã
- `yourCard` - –∫–∞—Ä—Ç–∞ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ –∏–≥—Ä–æ–∫–∞
- `newMessage` - –Ω–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —á–∞—Ç–µ
- `timerUpdate` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–∞–π–º–µ—Ä–∞
- `error` - –æ—à–∏–±–∫–∞

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

### Room (–ö–æ–º–Ω–∞—Ç–∞)
```javascript
{
  id: string,           // –ö–æ–¥ –∫–æ–º–Ω–∞—Ç—ã
  phase: string,        // –¢–µ–∫—É—â–∞—è —Ñ–∞–∑–∞
  players: Array,       // –ú–∞—Å—Å–∏–≤ –∏–≥—Ä–æ–∫–æ–≤
  votes: Object,        // –ì–æ–ª–æ—Å–∞
  messages: Array,      // –°–æ–æ–±—â–µ–Ω–∏—è —á–∞—Ç–∞
  timer: number,        // –¢–∞–π–º–µ—Ä –≤ —Å–µ–∫—É–Ω–¥–∞—Ö
  bunkerInfo: Object,   // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –±—É–Ω–∫–µ—Ä–µ
  catastrophe: string   // –¢–∏–ø –∫–∞—Ç–∞—Å—Ç—Ä–æ—Ñ—ã
}
```

### Player (–ò–≥—Ä–æ–∫)
```javascript
{
  id: string,           // UUID –∏–≥—Ä–æ–∫–∞
  name: string,         // –ò–º—è
  socketId: string,     // Socket.IO ID
  isHost: boolean,      // –•–æ—Å—Ç –ª–∏
  isAlive: boolean,     // –ñ–∏–≤ –ª–∏
  hasVoted: boolean,    // –ü—Ä–æ–≥–æ–ª–æ—Å–æ–≤–∞–ª –ª–∏
  card: Object         // –ö–∞—Ä—Ç–∞ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
}
```

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞

1. **CORS**: –£–∫–∞–∂–∏—Ç–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –¥–æ–º–µ–Ω—ã –≤–º–µ—Å—Ç–æ `*`
   ```javascript
   app.use(cors({
     origin: "https://your-client-domain.com"
   }));
   ```

2. **Rate Limiting**: –î–æ–±–∞–≤—å—Ç–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤
   ```bash
   npm install express-rate-limit
   ```

3. **Helmet**: –ó–∞—â–∏—Ç–∞ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤
   ```bash
   npm install helmet
   ```

## üìà –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –õ–æ–≥–∏ —Å PM2
```bash
pm2 logs bunker-server
```

### –°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–µ—Ä–∞
```bash
pm2 status
```

## üêõ –û—Ç–ª–∞–¥–∫–∞

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–î–æ–±–∞–≤—å—Ç–µ –≤ –Ω–∞—á–∞–ª–æ `server.js`:
```javascript
const DEBUG = process.env.DEBUG === 'true';
if (DEBUG) {
  console.log('Debug mode enabled');
}
```

–ó–∞–ø—É—Å–∫ —Å –¥–µ–±–∞–≥–æ–º:
```bash
DEBUG=true npm start
```

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- –°–µ—Ä–≤–µ—Ä –¥–µ—Ä–∂–∏—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤ –ø–∞–º—è—Ç–∏ (rooms –æ–±—ä–µ–∫—Ç)
- –ü—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ –≤—Å–µ –∏–≥—Ä—ã —Å–±—Ä–∞—Å—ã–≤–∞—é—Ç—Å—è
- –î–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –Ω—É–∂–Ω–∞ –ë–î (MongoDB, Redis)
- –¢–∞–π–º–µ—Ä—ã –æ—á–∏—â–∞—é—Ç—Å—è –ø—Ä–∏ –æ—Ç–∫–ª—é—á–µ–Ω–∏–∏ –∏–≥—Ä–æ–∫–æ–≤
—á—á—á—á